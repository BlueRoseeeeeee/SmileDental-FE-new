  // ğŸ†• Update valid holiday dates when selected subrooms change
  useEffect(() => {
    const updateValidHolidayDates = async () => {
      try {
        const allSchedules = scheduleListData?.schedules || [];
        
        if (allSchedules.length === 0) {
          setValidHolidayDates([]);
          return;
        }
        
        const firstSchedule = allSchedules[0];
        
        if (!firstSchedule || !firstSchedule.holidaySnapshot) {
          setValidHolidayDates([]);
          return;
        }
        
        const allSubRooms = scheduleListData?.subRooms || [];
        const hasSubRooms = allSubRooms.length > 0;
        
        // ğŸ”¥ Náº¿u cÃ³ subroom nhÆ°ng chÆ°a chá»n â†’ KhÃ´ng hiá»ƒn thá»‹ ngÃ y nÃ o
        if (hasSubRooms && selectedSubRoomsForOverride.length === 0) {
          console.log('âš ï¸ Room cÃ³ subrooms nhÆ°ng chÆ°a chá»n â†’ KhÃ´ng hiá»ƒn thá»‹ ngÃ y nghá»‰');
          setValidHolidayDates([]);
          return;
        }
        
        // ğŸ”¥ Lá»c schedules dá»±a vÃ o subrooms Ä‘Ã£ chá»n
        let schedulesToCheck = allSchedules;
        
        if (hasSubRooms) {
          // Chá»‰ check schedules cá»§a subrooms Ä‘Ã£ chá»n
          schedulesToCheck = allSchedules.filter(schedule => {
            const scheduleId = schedule._id || schedule.scheduleId;
            return selectedSubRoomsForOverride.includes(scheduleId);
          });
          
          console.log(`ğŸ” Filtering schedules: Selected ${selectedSubRoomsForOverride.length} subrooms â†’ ${schedulesToCheck.length} schedules to check`);
        }
        
        if (schedulesToCheck.length === 0) {
          setValidHolidayDates([]);
          return;
        }
        
        // ğŸ†• LOGIC: Chá»‰ hiá»ƒn thá»‹ ngÃ y náº¿u CÃ’N ÃT NHáº¤T 1 CA chÆ°a override trong CÃC SCHEDULES ÄÃƒ CHá»ŒN
        const dateShiftsStatus = new Map();
        
        schedulesToCheck.forEach(schedule => {
          const schedDaysOff = schedule.holidaySnapshot?.computedDaysOff || [];
          
          schedDaysOff.forEach(dayOff => {
            const dateStr = dayOff.date;
            
            if (!dateShiftsStatus.has(dateStr)) {
              dateShiftsStatus.set(dateStr, {
                morning: new Set(),
                afternoon: new Set(),
                evening: new Set()
              });
            }
            
            const shifts = dateShiftsStatus.get(dateStr);
            
            // Check tá»«ng ca: Náº¿u chÆ°a override trong schedule nÃ y â†’ ThÃªm scheduleId vÃ o Set
            if (dayOff.shifts?.morning && !dayOff.shifts.morning.isOverridden) {
              shifts.morning.add(schedule._id || schedule.scheduleId);
            }
            if (dayOff.shifts?.afternoon && !dayOff.shifts.afternoon.isOverridden) {
              shifts.afternoon.add(schedule._id || schedule.scheduleId);
            }
            if (dayOff.shifts?.evening && !dayOff.shifts.evening.isOverridden) {
              shifts.evening.add(schedule._id || schedule.scheduleId);
            }
          });
        });
        
        // Lá»c ngÃ y: Chá»‰ giá»¯ ngÃ y náº¿u CÃ’N ÃT NHáº¤T 1 CA chÆ°a override á»Ÿ ÃT NHáº¤T 1 schedule Ä‘Ã£ chá»n
        const validDates = Array.from(dateShiftsStatus.entries())
          .filter(([dateStr, shifts]) => {
            const hasAvailableShift = 
              shifts.morning.size > 0 || 
              shifts.afternoon.size > 0 || 
              shifts.evening.size > 0;
            return hasAvailableShift;
          })
          .map(([dateStr]) => dateStr)
          .sort();
        
        console.log(`ğŸ“… Valid holiday dates (cÃ²n Ã­t nháº¥t 1 ca chÆ°a override trong ${schedulesToCheck.length} schedules Ä‘Ã£ chá»n):`, validDates);
        
        setValidHolidayDates(validDates);
        
        // ğŸ”¥ Náº¿u ngÃ y Ä‘ang chá»n khÃ´ng cÃ²n valid â†’ Clear selection
        if (overrideDate && !validDates.includes(overrideDate.format('YYYY-MM-DD'))) {
          console.log('âš ï¸ NgÃ y Ä‘ang chá»n khÃ´ng cÃ²n available â†’ Clear selection');
          setOverrideDate(null);
          setAvailableShiftsInfo(null);
        }
        
      } catch (error) {
        console.error('Error updating valid holiday dates:', error);
        setValidHolidayDates([]);
      }
    };

    // Chá»‰ update náº¿u modal Ä‘ang má»Ÿ
    if (visible && scheduleListData) {
      updateValidHolidayDates();
    }
  }, [visible, scheduleListData, selectedSubRoomsForOverride, overrideDate]);
